# coding:utf-8
import io
import os
import sys
import numpy as np
import estimate
from datetime import date
from PIL import Image
import tornado.escape
import tornado.ioloop
import tornado.web

img_dir = "./tmp/img/"

class PostDebugHandler(tornado.web.RequestHandler):
    def post(self):
        data = self.request.files['file'][0]['body']
        img = Image.open(io.BytesIO(data))
        img_path = img_dir+"tmp.png"
        img.save(img_path)
        res = estimate.estimate(img_dir)
        
        self.write({"result":res})



application = tornado.web.Application([
    (r"/debug", PostDebugHandler)
])

if __name__ == "__main__":
    application.listen(5000)
    tornado.ioloop.IOLoop.instance().start()
